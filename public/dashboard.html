<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RepoJudge Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css?v=26">

    <!-- Critical CSS - prevents flash of unstyled content -->
    <style>
        :root {
            --bg-primary: #0a0a0f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0f;
            color: #e4e4e7;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }

        .bg-grid {
            position: fixed;
            inset: 0;
            background-image: linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
            z-index: 0;
        }
    </style>
</head>

<body class="dashboard-page" style="background: #0a0a0f;">
    <div class="bg-grid"></div>
    <div class="bg-glow-container">
        <div class="glow-blob glow-1"></div>
        <div class="glow-blob glow-2"></div>
        <div class="glow-blob glow-3"></div>
        <div class="glow-blob glow-4"></div>
    </div>

    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <i class='bx bx-code-block'></i>
                    <span>RepoJudge</span>
                </a>
            </div>

            <button id="newAnalysisBtn" class="new-analysis-btn">
                <i class='bx bx-plus'></i> <span data-i18n="newAnalysis">New Analysis</span>
            </button>

            <div class="sidebar-scroll">
                <!-- Navigation / Scrollable Area -->
                <div class="sidebar-nav">
                    <!-- History Items -->
                    <div id="historySection" class="history-section">
                        <div class="section-header">
                            <h4 data-i18n="history">Analysis History</h4>
                            <button id="newFolderBtn" class="icon-btn-small" title="New Folder">
                                <i class='bx bx-folder-plus'></i>
                            </button>
                        </div>
                        <div id="historyList" class="history-list">
                            <!-- populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- User Repos (Pinned to Bottom) -->
                <div id="reposSection" class="repos-section hidden">
                    <h4 data-i18n="yourRepos">Your Repos</h4>
                    <div id="reposList" class="repos-list">
                        <!-- populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="sidebar-footer">
                <!-- Settings Popover -->
                <div id="settingsMenu" class="settings-menu">
                    <div class="settings-profile-header">
                        <span id="settingsUserEmail" class="user-email">guest@repojudge.yongdohyun.org.tr</span>
                    </div>
                    <div class="menu-divider"></div>
                    <div class="menu-item" id="upgradePlanBtn">
                        <i class='bx bx-crown'></i> <span data-i18n="upgradePlan">Planƒ± y√ºkselt</span>
                    </div>
                    <div class="menu-item" id="profileMenuItem">
                        <i class='bx bx-user'></i> <span data-i18n="settings">Ayarlar</span>
                        <span class="shortcut">‚åò,</span>
                    </div>
                    <div class="menu-item" id="langToggleItem">
                        <i class='bx bx-globe'></i> <span>Language:</span> <span id="currentLangDisplay"
                            class="lang-val">EN</span>
                    </div>
                    <div class="menu-item" id="apiSettingsItem">
                        <i class='bx bx-key'></i> <span>API Settings</span>
                    </div>
                    <div class="menu-divider"></div>
                    <div class="menu-item danger" id="logoutMenuItem">
                        <i class='bx bx-log-out'></i> <span data-i18n="logout">Oturumu Kapat</span>
                    </div>
                    <div class="menu-item" id="loginMenuItem">
                        <i class='bx bxl-github'></i> <span data-i18n="loginGithub">Login with GitHub</span>
                    </div>
                </div>

                <!-- User/Settings Trigger -->
                <button class="user-menu-btn" id="userMenuBtn">
                    <div class="user-avatar-container">
                        <img id="sidebarUserAvatar" src="" alt="User" class="avatar-img hidden">
                        <div id="sidebarDefaultAvatar" class="avatar-placeholder"><i class='bx bx-user'></i></div>
                    </div>
                    <div class="user-info">
                        <span class="user-name" id="sidebarUserName">Guest</span>
                        <span class="user-plan" id="sidebarUserPlan">Free Plan</span>
                    </div>
                    <i class='bx bx-dots-horizontal-rounded menu-icon'></i>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="welcome-screen">
                <div class="welcome-content">
                    <div class="badge">
                        <i class='bx bx-bug'></i>
                        AI-Powered Static Code Analysis
                    </div>
                    <h1 data-i18n="title">Analyze Your Code</h1>
                    <p data-i18n="subtitle">Paste a GitHub repository URL to get started</p>

                    <div class="input-box">
                        <i class='bx bxl-github'></i>
                        <input type="text" id="repoUrl" placeholder="https://github.com/username/repository"
                            data-i18n-placeholder="repoPlaceholder">

                        <!-- Model Selector -->
                        <div class="model-selector-container">
                            <select id="modelSelect" class="model-select">
                                <option value="flash">‚ö° Gemini 3.0 Flash</option>
                                <option value="pro">üöÄ Gemini 3.0 Pro</option>
                            </select>
                        </div>

                        <button id="analyzeBtn" class="analyze-btn">
                            <span data-i18n="analyze">Analyze</span>
                            <i class='bx bx-right-arrow-alt'></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading Screen -->
            <div id="loadingScreen" class="loading-screen hidden">
                <div class="loader">
                    <div class="spinner"></div>
                    <p id="loadingText" data-i18n="loading">Analyzing repository...</p>
                </div>
            </div>

            <!-- Analysis View -->
            <div id="analysisView" class="analysis-view hidden">
                <div class="analysis-header">
                    <div class="repo-info">
                        <i class='bx bx-git-repo-forked'></i>
                        <span id="repoName">owner/repo</span>
                    </div>

                    <div class="analysis-tabs">
                        <button class="tab active" data-tab="overview" data-i18n="overview">Overview</button>
                        <button class="tab" data-tab="issues" data-i18n="issues">Issues</button>
                        <button class="tab" data-tab="security" data-i18n="security">Security</button>
                        <button class="tab" data-tab="readme" data-i18n="readme">README</button>
                    </div>

                    <button class="badge-btn" id="getBadgeBtn">
                        <i class='bx bx-medal'></i> <span data-i18n="getBadge">Get Badge</span>
                    </button>
                </div>

                <div class="tab-panels">
                    <!-- Overview Panel -->
                    <div id="overview-panel" class="tab-panel active">
                        <div class="metrics-row">
                            <div class="metric-card health">
                                <div class="metric-icon"><i class='bx bx-heart'></i></div>
                                <div class="metric-info">
                                    <span class="metric-value" id="healthScore">--</span>
                                    <span class="metric-label" data-i18n="healthScore">Health Score</span>
                                </div>
                                <button class="info-btn" id="scoringInfoBtn" title="Nasƒ±l puanlanƒ±yor?">
                                    <i class='bx bx-help-circle'></i>
                                </button>
                            </div>
                            <div class="metric-card issues-count">
                                <div class="metric-icon"><i class='bx bx-error-circle'></i></div>
                                <div class="metric-info">
                                    <span class="metric-value" id="totalIssues">--</span>
                                    <span class="metric-label" data-i18n="totalIssues">Total Issues</span>
                                </div>
                            </div>
                            <div class="metric-card critical-count">
                                <div class="metric-icon"><i class='bx bx-x-circle'></i></div>
                                <div class="metric-info">
                                    <span class="metric-value" id="criticalCount">--</span>
                                    <span class="metric-label" data-i18n="critical">Critical</span>
                                </div>
                            </div>
                            <div class="metric-card security-count">
                                <div class="metric-icon"><i class='bx bx-shield-quarter'></i></div>
                                <div class="metric-info">
                                    <span class="metric-value" id="securityCount">--</span>
                                    <span class="metric-label" data-i18n="securityIssues">Security</span>
                                </div>
                            </div>
                        </div>

                        <div class="summary-section">
                            <h3 data-i18n="summary"><i class='bx bx-layer'></i> Summary</h3>
                            <p id="summaryText">Analysis summary will appear here...</p>
                        </div>

                        <!-- Recommendations - PROMINENT POSITION -->
                        <div class="recommendations-section highlight-section">
                            <div class="section-header">
                                <h3><i class='bx bx-bulb'></i> üí° √ñneriler <span class="section-badge">AI Powered</span>
                                </h3>
                                <p class="section-subtitle">Projenizi bir √ºst seviyeye ta≈üƒ±mak i√ßin yapƒ±labilecekler</p>
                            </div>
                            <div id="recommendationsList" class="recommendations-grid"></div>
                        </div>

                        <div class="grid-2-col">
                            <div class="issues-section">
                                <div class="section-header">
                                    <h3 data-i18n="strengths"><i class='bx bx-star'></i> Strengths</h3>
                                </div>
                                <ul id="strengthsList" class="custom-list"></ul>
                            </div>
                            <div class="issues-section">
                                <div class="section-header">
                                    <h3 data-i18n="competitors"><i class='bx bx-target-lock'></i> Competitors</h3>
                                </div>
                                <ul id="competitorsList" class="custom-list"></ul>
                            </div>
                        </div>

                        <div class="issues-section">
                            <div class="section-header">
                                <h3 data-i18n="errors"><i class='bx bx-error'></i> Errors & Critical Issues</h3>
                            </div>
                            <div id="errorsList" class="issues-grid"></div>
                        </div>
                    </div>

                    <!-- Issues Panel -->
                    <div id="issues-panel" class="tab-panel">
                        <div class="section-header">
                            <h3 data-i18n="all"><i class='bx bx-list-ul'></i> All Issues</h3>
                            <div class="issue-filters">
                                <button class="filter-btn active" data-filter="all" data-i18n="all">All</button>
                                <button class="filter-btn" data-filter="critical">Critical</button>
                                <button class="filter-btn" data-filter="high">High</button>
                                <button class="filter-btn" data-filter="medium">Medium</button>
                                <button class="filter-btn" data-filter="low">Low</button>
                            </div>
                        </div>
                        <div id="issuesList" class="issues-grid"></div>
                    </div>

                    <!-- Security Panel -->
                    <div id="security-panel" class="tab-panel">
                        <div class="section-header">
                            <h3 data-i18n="security"><i class='bx bx-shield'></i> Security Vulnerabilities</h3>
                        </div>
                        <div id="securityList" class="issues-grid"></div>
                    </div>

                    <!-- Chat Panel -->
                    <div id="chat-panel" class="tab-panel">
                        <div class="chat-container">
                            <div id="chatMessages" class="chat-messages-modern">
                                <!-- Messages will appear here -->
                            </div>
                            <div class="chat-input-area-modern">
                                <input type="text" id="chatInput" placeholder="Koda dair her ≈üeyi sorabilirsin..."
                                    autocomplete="off">
                                <button id="sendChatBtn">
                                    <i class='bx bxs-send'></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- README Panel -->
                    <div id="readme-panel" class="tab-panel">
                        <div class="section-header">
                            <h3 data-i18n="readme"><i class='bx bx-file'></i> Generated README</h3>
                            <div class="action-buttons">
                                <button class="icon-btn" id="copyReadmeBtn" title="Copy"><i
                                        class='bx bx-copy'></i></button>
                                <button class="icon-btn" id="downloadReadmeBtn" title="Download"><i
                                        class='bx bx-download'></i></button>
                            </div>
                        </div>
                        <div class="readme-container">
                            <div id="readmePreview" class="markdown-body"></div>
                            <pre id="readmeSource" class="hidden"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Badge Modal (NEW) -->
    <div id="badgeModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Get Your Repository Badge üèÖ</h3>
                <button class="close-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p>Add this badge to your GitHub README.md to show off your code quality score!</p>

                <div class="badge-preview">
                    <img id="badgeImage" src="" alt="RepoJudge Score">
                </div>

                <div class="code-box">
                    <span class="code-label">Markdown</span>
                    <code id="badgeCode"></code>
                    <button class="copy-code-btn"><i class='bx bx-copy'></i></button>
                </div>
            </div>
        </div>
    </div>


    <!-- Scoring Info Modal -->
    <div id="scoringModal" class="modal hidden">
        <div class="modal-content scoring-info-modal">
            <button class="close-modal">&times;</button>
            <h2><i class='bx bx-info-circle'></i> Nasƒ±l Puanlƒ±yoruz?</h2>

            <div class="scoring-section">
                <h3>üéØ Puanlama Sistemi</h3>
                <p>Her proje <strong>95 puan</strong> ile ba≈ülar. Sadece ger√ßek sorunlar i√ßin puan d√º≈ü√ºr√ºl√ºr:</p>
                <ul>
                    <li><span class="deduct">-20</span> G√ºvenlik a√ßƒ±klarƒ± (SQLi, XSS, vb.)</li>
                    <li><span class="deduct">-15</span> √á√∂kme riski / mantƒ±k hatalarƒ±</li>
                    <li><span class="deduct">-10</span> Kullanƒ±lmayan / √∂l√º kod</li>
                    <li><span class="deduct">-10</span> Spaghetti kod yapƒ±sƒ±</li>
                </ul>
            </div>

            <div class="scoring-section">
                <h3>üìä Puan Aralƒ±klarƒ±</h3>
                <div class="score-ranges">
                    <div class="range elite"><span>95-100</span> Elite - M√ºkemmel</div>
                    <div class="range pro"><span>80-94</span> Profesyonel - √úretime hazƒ±r</div>
                    <div class="range avg"><span>60-79</span> Ortalama - Geli≈ütirilebilir</div>
                    <div class="range poor"><span>0-59</span> Kritik - Acil m√ºdahale gerekli</div>
                </div>
            </div>

            <div class="scoring-section">
                <h3>üí° √ñneriler</h3>
                <p>√ñneriler, projenizde eksik olan best practice'lere g√∂re otomatik olu≈üturulur: Test yoksa test
                    √∂nerilir, CI/CD yoksa pipeline √∂nerilir, vs.</p>
            </div>
        </div>
    </div>

    <!-- API Settings Modal -->
    <div id="apiSettingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>API Settings</h3>
                <button class="close-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <p>Set your API keys for this device. Values are stored in localStorage on this device.</p>
                <div class="settings-form">
                    <label class="settings-label" for="geminiKeyInput">Gemini API Key (GEMINI_API_KEY)</label>
                    <input id="geminiKeyInput" class="settings-input" type="password" autocomplete="off"
                        placeholder="AIzaSyxxxxxxxxxxxxxxxxxxxx">
                    <span class="settings-help">Optional if the backend already has GEMINI_API_KEY configured.</span>
                    <span id="geminiKeyStatus" class="settings-help"></span>

                    <label class="settings-label" for="githubClientIdInput">GitHub Client ID (GITHUB_CLIENT_ID)</label>
                    <input id="githubClientIdInput" class="settings-input" type="text" autocomplete="off"
                        placeholder="Ov23lxxxxxxxxxxxxxx">
                    <span class="settings-help">OAuth App Client ID for login and private repo access.</span>

                    <label class="settings-label" for="githubClientSecretInput">GitHub Client Secret (GITHUB_CLIENT_SECRET)</label>
                    <input id="githubClientSecretInput" class="settings-input" type="password" autocomplete="off"
                        placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                    <span class="settings-help">Used by the backend during OAuth token exchange.</span>
                    <span id="githubClientStatus" class="settings-help"></span>

                    <label class="settings-label" for="sessionSecretInput">Session Secret (SESSION_SECRET)</label>
                    <input id="sessionSecretInput" class="settings-input" type="password" autocomplete="off"
                        placeholder="your_random_session_secret">
                    <span class="settings-help">Used for session signing on the backend.</span>

                    <span id="storageNote" class="settings-help hidden">Local storage is disabled; settings will only persist for this session.</span>
                </div>
                <div class="settings-actions">
                    <button class="settings-btn ghost" id="clearApiSettings">Clear</button>
                    <button class="settings-btn primary" id="saveApiSettings">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // Optional: set the Cloudflare Worker origin if backend is on a different host.
        // window.__API_BASE__ = 'https://your-worker.yourdomain.workers.dev';
    </script>
    <script src="js/app.js?v=27"></script>
</body>

</html>
